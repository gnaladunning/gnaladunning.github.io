<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TVTALK AR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      touch-action: none;
      background: #000;
    }
    #politicalCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 1;
      pointer-events: none;
      background: #000;
      object-fit: cover;
      display: block;
    }
    #videoElement {
      display: none;
    }
  </style>
</head>
<body>
  <video id="videoElement" autoplay playsinline muted></video>
  <canvas id="politicalCanvas"></canvas>
  <script>
    const politicalCanvas = document.getElementById('politicalCanvas');
    const video = document.getElementById('videoElement');
    const ctx = politicalCanvas.getContext('2d');

    // AR Paragraph/Cluster settings (refresh much more slowly)
    const PARAGRAPH_INTERVAL = 160000;  // ms per paragraph (much slower for refresh)
    const FADE_DURATION = 30000;  // ms for fade transition (slow for readability)
    const APPEAR_DURATION = 30000; // ms for new cluster/paragraph fade-in
    const DISAPPEAR_DURATION = 30000; // ms for cluster/paragraph fade-out
    const MAX_CLUSTERS = 5;

    // Lowercase, multiline movie and TV show descriptions (expanded to 100)
    const descriptions = [
      // 1-10
      `a group of friends discover strange events in their quiet town, uncovering secrets and facing challenges together as they navigate the mysteries hidden beneath the surface.`,
      `in a dystopian future, individuals fight for survival and meaning while society watches their every move, exploring themes of freedom, control, and the human spirit.`,
      `an ordinary family deals with extraordinary circumstances, learning the importance of trust and resilience as they face unexpected obstacles in their daily lives.`,
      `a detective pursues a complex case that gradually blurs the boundaries between right and wrong, leading to revelations about loyalty, justice, and the power of truth.`,
      `a young person embarks on a journey of self-discovery, encountering allies and adversaries, and learning that courage can take many forms in a world full of uncertainty.`,
      `a pair of travelers wander through unfamiliar lands, meeting people whose stories change their own, and realizing that every journey leaves a mark on the soul.`,
      `a small community comes together during a crisis, finding hope and connection in moments of adversity, and rediscovering what it means to belong.`,
      `an ambitious artist struggles to balance dreams and reality, facing setbacks and moments of inspiration as creativity becomes both a refuge and a challenge.`,
      `a scientist makes a breakthrough that could alter the future, but must grapple with ethical dilemmas and the consequences of knowledge that cannot be unlearned.`,
      `siblings reunite after years apart, confronting old wounds and forging new bonds as they navigate the complexities of family, forgiveness, and change.`,
      // 11-20
      `a mysterious figure enters a small town, changing the lives of its residents as secrets unravel and destinies intertwine.`,
      `a family road trip turns into an adventure of unexpected encounters and revelations, testing their bonds and resilience.`,
      `a struggling musician finds inspiration in the most unlikely places, learning to trust in the power of creativity.`,
      `a chef opens a restaurant against all odds, facing competition and personal challenges while redefining success.`,
      `a teacher inspires her students to overcome adversity, proving that hope can flourish in unexpected circumstances.`,
      `a group of teenagers stumble upon an ancient artifact, setting off a chain of events that brings them together.`,
      `an astronaut faces isolation in deep space, finding strength in memories and the quest for connection.`,
      `a retired athlete mentors a new generation, rediscovering purpose and confronting his own regrets.`,
      `a young inventor defies expectations, showing that innovation often starts with a simple idea.`,
      `a lost dog helps a community rediscover compassion and unity through small acts of kindness.`,
      // 21-30
      `a journalist investigates a controversial story, risking reputation and safety for the pursuit of truth.`,
      `an artist struggles to finish her masterpiece, confronting self-doubt and the pressures of public opinion.`,
      `a businessman faces a moral dilemma, learning that integrity is sometimes the hardest choice.`,
      `a group of strangers are stranded together, learning to cooperate and empathize despite their differences.`,
      `a scientist discovers a new species, confronting ethical questions about progress and preservation.`,
      `a child befriends an elderly neighbor, showing that friendship can bridge any gap in age or experience.`,
      `an aspiring actor navigates the highs and lows of fame, learning that authenticity matters most.`,
      `a nurse goes above and beyond during a crisis, demonstrating the true meaning of empathy.`,
      `a tech entrepreneur launches a startup, facing unexpected challenges and redefining ambition.`,
      `a farmer battles the elements and changing times, holding onto tradition while embracing the future.`,
      // 31-40
      `a city is transformed by a sudden event, forcing residents to adapt and come together in new ways.`,
      `a young athlete strives for a championship, learning that victory is about more than winning.`,
      `a group of explorers venture into unknown territory, finding courage in the face of uncertainty.`,
      `a teacher challenges outdated norms, sparking change in her school and community.`,
      `a chef creates a dish that inspires a movement, showing how food can bring people together.`,
      `a single parent juggles work and family, finding moments of joy amid daily struggles.`,
      `a librarian uncovers a secret in the archives, leading to discoveries that change lives.`,
      `a doctor faces a difficult decision, balancing duty and compassion in a high-stakes moment.`,
      `a couple navigates long-distance love, proving that connection can endure across time and space.`,
      `a playwright overcomes writer's block, learning to trust her voice and vision.`,
      // 41-50
      `a photographer captures life in fleeting moments, revealing beauty in the ordinary.`,
      `a refugee finds hope in a new country, building community and overcoming adversity.`,
      `a young woman stands up for her beliefs, inspiring others to follow her lead.`,
      `a mechanic restores a vintage car, reconnecting with family history and lost dreams.`,
      `a group of kids start a club, learning teamwork and the value of friendship.`,
      `a scientist develops a vaccine, racing against time for the greater good.`,
      `a dancer returns to the stage after injury, rediscovering passion and resilience.`,
      `a child finds magic in an everyday object, turning imagination into adventure.`,
      `a volunteer brings aid to those in need, making a difference one act at a time.`,
      `a couple renovates their home, facing surprises and strengthening their relationship.`,
      // 51-60
      `a mathematician solves a centuries-old puzzle, challenging assumptions and inspiring others.`,
      `a teenager navigates social pressures, learning to stay true to herself.`,
      `a painter confronts criticism, growing through vulnerability and self-reflection.`,
      `a group of hikers brave the elements, discovering teamwork and perseverance.`,
      `a chef fuses diverse flavors, creating unity through culinary innovation.`,
      `a child helps a lost animal, learning empathy and responsibility.`,
      `a community rallies to save a landmark, preserving heritage for future generations.`,
      `a firefighter faces a dangerous blaze, showing courage in the line of duty.`,
      `an inventor creates a device that transforms lives, facing skepticism and hope.`,
      `a teacher supports a struggling student, fostering growth and confidence.`,
      // 61-70
      `a journalist uncovers corruption, risking safety and reputation for justice.`,
      `a musician reunites with old friends, rekindling creativity and joy.`,
      `a scientist debates the ethics of discovery, shaping the future of research.`,
      `a child explores a mysterious forest, uncovering secrets and learning bravery.`,
      `a parent helps a child cope with loss, nurturing healing and resilience.`,
      `a programmer cracks a complex code, showcasing ingenuity and persistence.`,
      `a nurse comforts patients in crisis, embodying compassion and care.`,
      `a coach inspires athletes to believe in themselves, building confidence and camaraderie.`,
      `a playwright stages a controversial show, sparking dialogue and reflection.`,
      `a couple faces unexpected challenges, discovering strength in partnership.`,
      // 71-80
      `a teacher fights for equal education, transforming lives through advocacy.`,
      `a farmer innovates to survive, blending tradition and technology.`,
      `a traveler finds beauty in the unfamiliar, embracing new perspectives.`,
      `a scientist pioneers renewable energy, shaping a sustainable future.`,
      `a student overcomes bullying, finding support and empowerment.`,
      `a chef celebrates cultural heritage, connecting people through food.`,
      `a family adopts a child, building love and understanding.`,
      `an artist creates a public mural, inspiring hope and unity.`,
      `a journalist documents a historic event, preserving truth for future generations.`,
      `a volunteer organizes a fundraiser, mobilizing community and generosity.`,
      // 81-90
      `a dancer embraces a new style, expanding creative horizons.`,
      `a musician composes a symphony, weaving emotion and experience.`,
      `a child discovers a hidden talent, gaining confidence and joy.`,
      `a group of friends start a podcast, exploring ideas and building connection.`,
      `a scientist advocates for conservation, protecting endangered species.`,
      `a chef launches a food truck, bringing flavor and innovation to the streets.`,
      `a teacher mentors new educators, shaping the future of learning.`,
      `a doctor volunteers abroad, making a global impact.`,
      `a playwright writes a story of hope, inspiring audiences everywhere.`,
      `a student organizes a protest, standing up for justice and change.`,
      // 91-100
      `a researcher collaborates across borders, advancing knowledge together.`,
      `a parent supports a child's dreams, fostering growth and possibility.`,
      `a journalist challenges stereotypes, promoting understanding and empathy.`,
      `a community builds a garden, cultivating food and friendship.`,
      `a dancer teaches children, passing on passion and skill.`,
      `a scientist develops new medicine, saving lives and offering hope.`,
      `a teacher adapts to changing times, innovating for student success.`,
      `a musician finds inspiration in nature, composing melodies of renewal.`,
      `a group of friends volunteer at a shelter, making a difference in small ways.`,
      `an artist transforms recycled materials, creating beauty from waste.`
    ];

    // Expanded color sampling (keep original logic for greenish/cyan/yellowish)
    function isWideRangeColor(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      let max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;
      if (max === min) {
        h = s = 0;
      } else {
        let d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = ((g - b) / d + (g < b ? 6 : 0)); break;
          case g: h = ((b - r) / d + 2); break;
          case b: h = ((r - g) / d + 4); break;
        }
        h /= 6;
      }
      const greenish = h >= 0.2 && h <= 0.45;
      const yellowish = h >= 0.12 && h < 0.2;
      const cyanish = h > 0.45 && h < 0.55;
      const bright = l > 0.28;
      const colorful = s > 0.35;
      return (greenish || yellowish || cyanish) && bright && colorful;
    }

    // Cluster detection with flag for clusters moving out of view
    function clusterColorPixels(data, width, height) {
      const visited = new Uint8Array(width * height);
      const clusters = [];
      const pixelIndex = (x, y) => (y * width + x) * 4;
      for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
          const idx = y * width + x;
          if (visited[idx]) continue;
          const i = pixelIndex(x, y);
          if (isWideRangeColor(data[i], data[i + 1], data[i + 2])) {
            const queue = [[x, y]];
            const cluster = [];
            let minX = x, maxX = x, minY = y, maxY = y;
            visited[idx] = 1;
            while (queue.length) {
              const [cx, cy] = queue.pop();
              cluster.push([cx, cy]);
              minX = Math.min(minX, cx); maxX = Math.max(maxX, cx);
              minY = Math.min(minY, cy); maxY = Math.max(maxY, cy);
              for (let dx = -1; dx <= 1; dx++) {
                for (let dy = -1; dy <= 1; dy++) {
                  const nx = cx + dx, ny = cy + dy;
                  if (nx < 0 || nx >= width || ny < 0 || ny >= height) continue;
                  const nidx = ny * width + nx;
                  if (!visited[nidx]) {
                    const ni = pixelIndex(nx, ny);
                    if (isWideRangeColor(data[ni], data[ni + 1], data[ni + 2])) {
                      queue.push([nx, ny]);
                      visited[nidx] = 1;
                    }
                  }
                }
              }
            }
            // Only keep clusters fully visible
            if (
              cluster.length > 18 &&
              minX > 0 && maxX < width - 1 &&
              minY > 0 && maxY < height - 1
            ) {
              clusters.push(cluster);
              if (clusters.length >= MAX_CLUSTERS) return clusters; // Limit to 5 clusters
            }
          }
        }
      }
      return clusters;
    }

    function getClusterCenter(cluster) {
      let sumX = 0, sumY = 0;
      for (const [x, y] of cluster) {
        sumX += x;
        sumY += y;
      }
      return [sumX / cluster.length, sumY / cluster.length];
    }

    function getClusterSize(cluster) {
      let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
      for (const [x, y] of cluster) {
        minX = Math.min(minX, x); maxX = Math.max(maxX, x);
        minY = Math.min(minY, y); maxY = Math.max(maxY, y);
      }
      return Math.sqrt((maxX - minX) * (maxY - minY) + cluster.length); // area proxy
    }

    function pickDescription() {
      return descriptions[Math.floor(Math.random() * descriptions.length)];
    }

    // Cluster management with fade-in/fade-out
    let clusterStates = [];
    let prevClusterCenters = [];

    function updateClusters(currentCenters, currentSizes) {
      // Match clusters by proximity
      let newStates = [];
      let matched = new Set();
      for (let i = 0; i < currentCenters.length; i++) {
        let center = currentCenters[i];
        let size = currentSizes[i];
        let foundIdx = -1, minDist = Infinity;
        for (let j = 0; j < clusterStates.length; j++) {
          let prev = clusterStates[j];
          if (prev.status === "disappearing") continue;
          let dist = Math.hypot(center[0] - prev.center[0], center[1] - prev.center[1]);
          if (dist < 60 && dist < minDist && !matched.has(j)) {
            minDist = dist;
            foundIdx = j;
          }
        }
        if (foundIdx !== -1) {
          // Existing cluster: update center & size
          let prev = clusterStates[foundIdx];
          newStates.push({
            ...prev,
            center,
            size,
            appearStart: prev.appearStart,
            status: "visible",
            disappearStart: null,
            lastUpdate: Date.now()
          });
          matched.add(foundIdx);
        } else {
          // New cluster: fade in
          newStates.push({
            center,
            size,
            description: pickDescription(),
            nextDescription: pickDescription(),
            descFade: 1,
            descLastChange: Date.now(),
            appearStart: Date.now(),
            status: "appearing",
            disappearStart: null,
            depth: Math.random(),
            lastUpdate: Date.now()
          });
        }
      }

      // Existing clusters not matched: fade out
      for (let j = 0; j < clusterStates.length; j++) {
        if (matched.has(j)) continue;
        let prev = clusterStates[j];
        if (prev.status === "disappearing" && prev.disappearStart && Date.now() - prev.disappearStart < DISAPPEAR_DURATION) {
          // Continue fading out
          newStates.push(prev);
        } else if (prev.status !== "disappearing") {
          // Start fade out
          newStates.push({
            ...prev,
            status: "disappearing",
            disappearStart: Date.now()
          });
        }
      }
      // Limit to MAX_CLUSTERS
      clusterStates = newStates.slice(0, MAX_CLUSTERS);
    }

    function updateDescriptionTransitions() {
      const now = Date.now();
      for (let cluster of clusterStates) {
        // Fade-in new cluster
        if (cluster.status === "appearing" && cluster.appearStart) {
          let t = (now - cluster.appearStart) / APPEAR_DURATION;
          cluster.appearProgress = Math.min(1, t);
          if (cluster.appearProgress >= 1) {
            cluster.status = "visible";
            cluster.appearStart = null;
            cluster.appearProgress = 1;
          }
        }
        // Fade-out disappearing cluster
        if (cluster.status === "disappearing" && cluster.disappearStart) {
          let t = (now - cluster.disappearStart) / DISAPPEAR_DURATION;
          cluster.disappearProgress = Math.min(1, t);
        }
        // Description fade (for changing descriptions)
        if (cluster.descFade < 1) {
          let t = (now - cluster.descLastChange) / FADE_DURATION;
          cluster.descFade = Math.min(1, t);
          if (cluster.descFade >= 1) {
            cluster.description = cluster.nextDescription;
          }
        }
      }
    }

    function triggerDescriptionChanges() {
      for (let cluster of clusterStates) {
        cluster.nextDescription = pickDescription();
        cluster.descFade = 0;
        cluster.descLastChange = Date.now();
        cluster.depth = Math.random();
      }
    }

    // Spline for smooth curves
    function getSplinePoints(points, tension = 0.5, numOfSeg = 18) {
      if (points.length < 2) return points;
      let result = [];
      for (let i = 0; i < points.length - 1; i++) {
        let p0 = points[i === 0 ? i : i - 1];
        let p1 = points[i];
        let p2 = points[i + 1];
        let p3 = points[i + 2 < points.length ? i + 2 : i + 1];
        for (let t = 0; t < numOfSeg; t++) {
          let st = t / numOfSeg;
          let x = catmullRom(p0[0], p1[0], p2[0], p3[0], st, tension);
          let y = catmullRom(p0[1], p1[1], p2[1], p3[1], st, tension);
          result.push([x, y]);
        }
      }
      return result;
    }

    function catmullRom(p0, p1, p2, p3, t, tension) {
      let v0 = (p2 - p0) * tension;
      let v1 = (p3 - p1) * tension;
      return (2 * p1 - 2 * p2 + v0 + v1) * t * t * t
           + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t * t
           + v0 * t
           + p1;
    }

    // Multiline text wrapping (at least 5 words per line)
    function wrapTextWords(text, maxWordsPerLine = 9, minWordsPerLine = 5) {
      const words = text.split(/\s+/);
      const lines = [];
      let i = 0;
      while (i < words.length) {
        let lineWords = words.slice(i, i + maxWordsPerLine);
        // Ensure at least minWordsPerLine unless it's the last line
        if (lineWords.length < minWordsPerLine && i + maxWordsPerLine < words.length) {
          lineWords = words.slice(i, i + minWordsPerLine);
          i += minWordsPerLine;
        } else {
          i += lineWords.length;
        }
        lines.push(lineWords.join(' '));
      }
      return lines;
    }

    // Draw text overlays (sharp, red, no shadow/halo, more centrally located)
    function drawColorOverlays(ctx, clusters) {
      updateDescriptionTransitions();
      ctx.save();
      // Draw smooth spline if enough clusters
      let centers = clusters.filter(c => c.status !== "disappearing" || (c.status === "disappearing" && c.disappearProgress < 1)).map(c => c.center);
      if (centers.length >= 2) {
        let spline = getSplinePoints(centers, 0.5, 18);
        ctx.beginPath();
        ctx.strokeStyle = "#FF4141";
        ctx.lineWidth = 2.5;
        ctx.globalAlpha = 0.38;
        for (let i = 0; i < spline.length - 1; i++) {
          let [x1, y1] = spline[i];
          let [x2, y2] = spline[i + 1];
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
        }
        ctx.stroke();
        ctx.globalAlpha = 1.0;
      }
      // Paragraphs at cluster centers, distributed and scaled by size (proximity)
      for (let i = 0; i < clusters.length; i++) {
        let cluster = clusters[i];
        let [x, y] = cluster.center;
        let z = cluster.depth || 0;
        let size = cluster.size;

        // --- FONT SIZE LOGIC - bigger and more varied ---
        // font size scales from 32px to 72px (previously: 18-28px)
        // randomize slightly for variety
        let minFont = 32, maxFont = 72;
        let norm = Math.max(0, Math.min(1, (size - 120) / (politicalCanvas.width * 0.13)));
        let randomFontOffset = Math.random() * 12 - 6; // -6..+6
        let fontSize = Math.round(minFont + norm * (maxFont - minFont) * (1 - z * 0.5) + randomFontOffset);

        // --- ALPHA LOGIC ---
        let minAlpha = 0.46, maxAlpha = 0.92;
        let alpha = maxAlpha - z * (maxAlpha - minAlpha);

        // Fade-in or fade-out for clusters
        let appearAlpha = 1.0;
        if (cluster.status === "appearing") appearAlpha = cluster.appearProgress || 0;
        if (cluster.status === "disappearing") appearAlpha = 1 - (cluster.disappearProgress || 0);
        alpha *= appearAlpha;

        // Fade description transitions
        let desc, descAlpha;
        if (cluster.descFade < 1) {
          desc = cluster.nextDescription;
          descAlpha = alpha * cluster.descFade * 0.85 + 0.15 * alpha;
        } else {
          desc = cluster.description;
          descAlpha = alpha;
        }

        // Prevent flicker by smoothly fading in/out and keeping alpha above a minimum threshold
        descAlpha = Math.max(0.14, descAlpha);

        ctx.save();

        // Force more centrally located:
        // Instead of drawing at cluster center, interpolate toward the screen center
        let centerX = politicalCanvas.width / 2;
        let centerY = politicalCanvas.height / 2;
        // Move 50% toward center from cluster center
        x = x * 0.5 + centerX * 0.5;
        y = y * 0.5 + centerY * 0.5;
        ctx.translate(x, y);

        ctx.font = `bold ${fontSize}px Arial, sans-serif`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.globalAlpha = descAlpha;

        // --- TEXT COLOUR: RED ---
        ctx.fillStyle = "#FF2020";
        // No shadow, no halo
        ctx.shadowColor = "transparent";
        ctx.shadowBlur = 0;

        // Draw wrapped multiline paragraph (at least 5 words per line)
        const lines = wrapTextWords(desc, 9, 5);
        let lineHeight = fontSize * 1.3;
        let totalHeight = lineHeight * lines.length;
        for (let j = 0; j < lines.length; j++) {
          ctx.fillText(lines[j], 0, (j - (lines.length-1)/2) * lineHeight);
        }

        ctx.restore();
      }
      ctx.restore();
    }

    let lastParagraphTrigger = Date.now();

    // PAUSE LOGIC
    let paused = false;
    let pauseUntil = 0;
    let nextPauseTime = Date.now() + getRandomPauseDelay();

    function getRandomPauseDelay() {
      // Random interval between 3s and 10s
      return 3000 + Math.random() * 7000;
    }

    function checkPauseTrigger() {
      const now = Date.now();
      if (!paused && now >= nextPauseTime) {
        paused = true;
        pauseUntil = now + getRandomPauseDelay(); // Pause for random 3-10s interval
      }
      if (paused && now >= pauseUntil) {
        paused = false;
        nextPauseTime = now + getRandomPauseDelay();
      }
    }

    function draw() {
      checkPauseTrigger();

      if (video.readyState === video.HAVE_ENOUGH_DATA) {
        if (politicalCanvas.width !== video.videoWidth || politicalCanvas.height !== video.videoHeight) {
          politicalCanvas.width = video.videoWidth;
          politicalCanvas.height = video.videoHeight;
        }
        ctx.filter = "blur(1.5px) brightness(1.18) contrast(1.18)";
        ctx.drawImage(video, 0, 0, politicalCanvas.width, politicalCanvas.height);
        ctx.filter = "none";
        let frame = ctx.getImageData(0, 0, politicalCanvas.width, politicalCanvas.height);
        let data = frame.data;
        let clusters;
        let clusterCenters, clusterAreaSizes;

        if (!paused) {
          clusters = clusterColorPixels(data, politicalCanvas.width, politicalCanvas.height);
          clusterCenters = clusters.map(getClusterCenter);
          clusterAreaSizes = clusters.map(getClusterSize);

          // Cluster fade-in/fade-out management
          updateClusters(clusterCenters, clusterAreaSizes);

          // If clusters have changed or moved out, update instantly (no flicker, slow transition)
          let centersChanged = false;
          if (prevClusterCenters.length !== clusterCenters.length) {
            centersChanged = true;
          } else {
            for (let i = 0; i < clusterCenters.length; i++) {
              if (
                Math.abs(clusterCenters[i][0] - (prevClusterCenters[i]?.[0] || 0)) > 80 ||
                Math.abs(clusterCenters[i][1] - (prevClusterCenters[i]?.[1] || 0)) > 80
              ) {
                centersChanged = true;
                break;
              }
            }
          }
          prevClusterCenters = clusterCenters.slice();

          if (centersChanged) {
            // Instead of instant description change, let clusters fade in/out
            // Only trigger next descriptions for clusters that remain visible
          }

          if (Date.now() - lastParagraphTrigger >= PARAGRAPH_INTERVAL) {
            triggerDescriptionChanges();
            lastParagraphTrigger = Date.now();
          }
        }

        // During pause, do not update clusters, just show last texts
        drawColorOverlays(ctx, clusterStates);
      }
      requestAnimationFrame(draw);
    }

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false })
      .then(stream => {
        video.srcObject = stream;
        video.play();
        video.addEventListener('loadedmetadata', () => {
          politicalCanvas.width = video.videoWidth;
          politicalCanvas.height = video.videoHeight;
          draw();
        });
      })
      .catch(() => {
        alert('Camera access denied or unavailable.');
      });

    window.addEventListener('resize', () => {
      politicalCanvas.width = window.innerWidth;
      politicalCanvas.height = window.innerHeight;
    });

    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        politicalCanvas.width = window.innerWidth;
        politicalCanvas.height = window.innerHeight;
      }, 500);
    });
  </script>
</body>
</html>
