<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden">
    <button id="start-ar" style="position:absolute;z-index:2;top:10px;left:10px;">Start AR</button>
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true; antialias: true;"
      style="display:none;"
      id="ar-scene"
    >
      <!-- Hiro marker; you can use other presets or custom markers -->
      <a-marker preset="hiro">
        <a-entity
          geometry="primitive: plane; width: 2; height: 2"
          rotation="-90 0 0"
          position="0 0 0"
          reflective-plane
        ></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
      <script>
        // Custom component for mirror effect
        AFRAME.registerComponent('reflective-plane', {
          init: function () {
            const tryApplyTexture = () => {
              const video = document.querySelector('video');
              if (!video) {
                setTimeout(tryApplyTexture, 300);
                return;
              }
              const mesh = this.el.getObject3D('mesh');
              if (!mesh) {
                this.el.addEventListener('model-loaded', () => tryApplyTexture());
                return;
              }
              const texture = new THREE.VideoTexture(video);
              texture.minFilter = THREE.LinearFilter;
              texture.magFilter = THREE.LinearFilter;
              texture.format = THREE.RGBFormat;
              mesh.material = new THREE.MeshPhongMaterial({
                map: texture,
                shininess: 100,
                side: THREE.DoubleSide,
                color: 0xffffff
              });
            };
            tryApplyTexture();
          }
        });
      </script>
    </a-scene>
    <script>
      // iOS requires a user gesture to start camera feed
      document.getElementById('start-ar').addEventListener('click', function() {
        document.getElementById('ar-scene').style.display = '';
        this.style.display = 'none';
      });
    </script>
  </body>
</html>
