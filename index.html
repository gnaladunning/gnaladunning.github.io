<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden">
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true; antialias: true;"
    >
      <!-- Marker: use Hiro marker or print your own -->
      <a-marker preset="hiro">
        <a-entity
          geometry="primitive: plane; width: 2; height: 2"
          rotation="-90 0 0"
          position="0 0 0"
          reflective-plane
        ></a-entity>
      </a-marker>

      <a-entity camera></a-entity>

      <script>
        // Custom component to make a plane reflective using the camera feed
        AFRAME.registerComponent('reflective-plane', {
          init: function () {
            // Wait for the AR.js video to be ready
            var video = document.querySelector('video');
            if (!video) {
              setTimeout(this.init.bind(this), 500);
              return;
            }
            var mesh = this.el.getObject3D('mesh');
            if (!mesh) {
              this.el.addEventListener('model-loaded', () => this.init());
              return;
            }
            // Use the video as a texture
            var texture = new THREE.VideoTexture(video);
            texture.minFilter = THREE.LinearFilter;
            texture.magFilter = THREE.LinearFilter;
            texture.format = THREE.RGBFormat;
            mesh.material = new THREE.MeshPhongMaterial({
              map: texture,
              reflectivity: 0.9,
              side: THREE.DoubleSide,
              color: 0xffffff,
              // For a simple mirror, you can use 'map' instead of 'envMap'
              map: texture
            });
          }
        });
      </script>
    </a-scene>
  </body>
</html>
