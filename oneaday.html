<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daily Image</title>
  <style>
    html,body {
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #111;
      color: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
    }
    .wrap {
      max-width:1000px;
      width:100%;
      padding:20px;
      box-sizing:border-box;
      text-align:center;
    }
    img#daily {
      width:100%;
      height:auto;
      max-height:80vh;
      object-fit:contain;
      border-radius:8px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      background: #222;
    }
    .credit {
      margin-top:12px;
      font-size:0.9rem;
      color:#bbb;
    }
    .error {
      color: #f88;
      margin-top:12px;
    }
    .nav-btns {
      margin-top:18px;
    }
    .nav-btns button {
      padding:8px 16px;
      margin:0 8px;
      border:none;
      border-radius:5px;
      background:#333;
      color:#fff;
      font-size:1rem;
      cursor:pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
      transition:background 0.2s;
    }
    .nav-btns button:disabled {
      opacity:0.5;
      cursor:not-allowed;
    }
    .nav-btns button:hover:not(:disabled) {
      background:#444;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <img id="daily" alt="Daily image" src="" />
    <div class="credit" id="credit"></div>
    <div class="nav-btns">
      <button id="prevBtn" type="button">Previous Image</button>
      <button id="todayBtn" type="button">Today</button>
    </div>
    <div class="error" id="error" role="status" aria-live="polite"></div>
  </div>

  <script>
    // CONFIG: update your folder and images.json (see below)
    const IMAGES_FOLDER = "images/";
    const MANIFEST_PATH = IMAGES_FOLDER + "images.json";

    // images.json example:
    // { "images": ["1.jpg", "2.jpg", "3.jpg", ...] }

    const imgEl = document.getElementById("daily");
    const creditEl = document.getElementById("credit");
    const errEl = document.getElementById("error");
    const prevBtn = document.getElementById("prevBtn");
    const todayBtn = document.getElementById("todayBtn");

    // Fetch image file manifest
    function fetchManifest() {
      return fetch(MANIFEST_PATH, {cache: "no-store"})
        .then(resp => resp.ok ? resp.json() : Promise.reject("Manifest not available"))
        .then(json => Array.isArray(json.images) ? json.images.slice() : [])
        .catch(_ => []);
    }

    // Fisher-Yates shuffle, seeded (so output is deterministic for given seed)
    function seededShuffle(array, seed) {
      let arr = array.slice();
      let random = seededRandom(seed); // returns fn [0,1)
      for (let i = arr.length - 1; i > 0; i--) {
        let j = Math.floor(random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // Simple seeded random generator (Mulberry32)
    function seededRandom(seed) {
      let s = typeof seed === "number" ? seed : hashString(seed);
      return function() {
        s |= 0; s = (s + 0x6D2B79F5) | 0;
        let t = Math.imul(s ^ (s >>> 15), 1 | s);
        t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }
    // Simple hash to convert a string to seed
    function hashString(str) {
      let hash = 5381;
      for(let i=0;i<str.length;i++){
        hash = ((hash << 5) + hash) + str.charCodeAt(i);
      }
      return hash >>> 0;
    }

    // Compute index for the given day
    function getIndexForDay(dayOffset, imagesLen, baseDateStr, seed) {
      // Calculate days since baseDate
      let today = new Date();
      let baseDate = baseDateStr ? new Date(baseDateStr) : new Date(today.getFullYear(), today.getMonth(), today.getDate());
      let daysSinceBase = Math.floor((Date.UTC(today.getFullYear(), today.getMonth(), today.getDate()) -
                                      Date.UTC(baseDate.getFullYear(), baseDate.getMonth(), baseDate.getDate()))/(24*60*60*1000));
      let index = daysSinceBase + dayOffset;
      // Clamp so always non-negative
      if (index < 0) index = 0;
      if (!imagesLen || imagesLen === 0) return 0;
      if (index >= imagesLen) index = imagesLen-1;
      return index;
    }

    function getBaseDateStr() {
      // If you want to start a sequence from a specific calendar date set it here, e.g. "2024-01-01"
      // Otherwise, default is today so first visitor sees first image then next day, the next image, etc.
      return "2024-01-01"; // <-- change this to your start date or to "" to start from today
    }

    // Extract filename (without extension) for caption
    function getTitleFromFilename(fname) {
      let base = fname.split('/').pop();
      let dotIdx = base.lastIndexOf('.');
      return dotIdx > 0 ? base.slice(0, dotIdx) : base;
    }

    // Rendering logic
    let images = [];
    let shuffledImages = [];
    let currentOffset = 0; // How many days before/after "today" (0=Today, -1=Yesterday...)

    function showImage(idx) {
      let file = shuffledImages[idx];
      if (!file) {
        imgEl.removeAttribute('src');
        creditEl.textContent = "";
        errEl.textContent = "No image for this day.";
        return;
      }
      let src = IMAGES_FOLDER + file;
      imgEl.src = src;
      creditEl.textContent = getTitleFromFilename(file);
      errEl.textContent = "";
    }

    function updateButtons() {
      prevBtn.disabled = (getIndexForDay(currentOffset-1, images.length, getBaseDateStr()) < 0);
      todayBtn.disabled = (currentOffset === 0);
    }

    function goTo(offset) {
      currentOffset = offset;
      let idx = getIndexForDay(currentOffset, images.length, getBaseDateStr());
      showImage(idx);
      updateButtons();
    }

    // Button events
    prevBtn.onclick = function() {
      currentOffset -= 1;
      goTo(currentOffset);
    };
    todayBtn.onclick = function() {
      currentOffset = 0;
      goTo(currentOffset);
    };

    // Init sequence
    fetchManifest().then(imgs => {
      if (!imgs.length) {
        showImage(-1);
        errEl.textContent = "No images found in manifest. Ensure images.json exists, and 'images' array lists your image files.";
        prevBtn.disabled = todayBtn.disabled = true;
        return;
      }
      images = imgs;
      // Shuffle the image list, with fixed seed so every client sees the same order for the same seed
      let seed = (getBaseDateStr() || "") + "-random-seed";
      shuffledImages = seededShuffle(images, seed);
      goTo(currentOffset);
    });

  </script>
</body>
</html>
